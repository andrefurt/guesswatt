---
description: "Architecture Decision Records - technical and product decisions with rationale"
globs:
  alwaysApply: true
---

# GuessWatts - Architecture Decision Records

Decis√µes t√©cnicas e de produto documentadas. Cada ADR segue o formato: contexto ‚Üí op√ß√µes ‚Üí decis√£o ‚Üí consequ√™ncias.

---

## √çndice

### Arquitectura
- [ADR-001](#adr-001-client-side-only) Client-Side Only
- [ADR-002](#adr-002-vanilla-js-sem-framework) Vanilla JS, Sem Framework
- [ADR-003](#adr-003-sem-build-step) Sem Build Step

### Dados
- [ADR-004](#adr-004-csvs-da-erse-como-fonte-prim√°ria) CSVs da ERSE como Fonte Prim√°ria
- [ADR-005](#adr-005-actualiza√ß√£o-manual-dos-csvs) Actualiza√ß√£o Manual dos CSVs
- [ADR-006](#adr-006-insights-erse-a-cada-4-meses) Insights ERSE a Cada 4 Meses

### Input & C√°lculo
- [ADR-007](#adr-007-input-√∫nico-com-op√ß√£o-pdf) Input √önico ‚Ç¨/m√™s com Op√ß√£o PDF
- [ADR-008](#adr-008-estimativa-vs-preciso) Estimativa vs Preciso (dois modos)
- [ADR-009](#adr-009-f√≥rmula-de-c√°lculo) F√≥rmula de C√°lculo
- [ADR-010](#adr-010-defaults-assumidos) Defaults Assumidos

### Output & UX
- [ADR-011](#adr-011-loss-framing) Loss Framing ("Perdes ‚Ç¨X")
- [ADR-012](#adr-012-cart√£o-de-oferta-com-detalhes-expans√≠veis) Cart√£o de Oferta com Detalhes Expans√≠veis
- [ADR-013](#adr-013-tooltips-para-termos-t√©cnicos) Tooltips para Termos T√©cnicos
- [ADR-014](#adr-014-top-n-ofertas-n√£o-todas) Top N Ofertas, N√£o Todas
- [ADR-015](#adr-015-contactos-reais-do-csv) Contactos Reais do CSV
- [ADR-021](#adr-021-provider-logo-implementation-hybrid-cascading-fallback) Provider Logo Implementation - Hybrid Cascading Fallback

### Funcionalidades
- [ADR-016](#adr-016-calend√°rio-2-meses-default) Calend√°rio: 2 Meses Default
- [ADR-017](#adr-017-pdf-parsing-client-side) PDF Parsing Client-Side
- [ADR-018](#adr-018-url-state-para-bookmarks) URL State para Bookmarks

### Scope
- [ADR-019](#adr-019-portugu√™s-de-portugal-apenas) Portugu√™s de Portugal Apenas
- [ADR-020](#adr-020-segmento-dom√©stico-apenas) Segmento Dom√©stico Apenas

---

## ADR-001: Client-Side Only

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
Precis√°vamos de uma ferramenta de compara√ß√£o de tarifas. Op√ß√µes:
1. Full-stack com base de dados e API
2. Site est√°tico com build step (Next.js, Vite)
3. Pure client-side com vanilla JS

**Decis√£o:**
Pure client-side. Todo o processamento acontece no browser do utilizador.

**Raz√µes:**
- Zero custos de hosting (GitHub Pages)
- Sem preocupa√ß√µes de seguran√ßa no backend
- PDFs ficam no browser (privacidade)
- ~13K linhas processam em <16ms
- Manuten√ß√£o mais simples
- Funciona offline ap√≥s primeiro load

**Consequ√™ncias:**
- ‚úÖ Privacidade total (dados nunca saem do browser)
- ‚úÖ Custo zero de infraestrutura
- ‚úÖ Performance excelente
- ‚ö†Ô∏è Actualiza√ß√£o manual dos CSVs
- ‚ö†Ô∏è Sem analytics server-side (pode adicionar client-side)

---

## ADR-002: Vanilla JS, Sem Framework

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
Dev moderno usa tipicamente React, Vue, ou similar. Consider√°mos:
1. React (familiar, componentes)
2. Vue (mais simples)
3. Vanilla JS (zero depend√™ncias)

**Decis√£o:**
Vanilla JavaScript com ES6+.

**Raz√µes:**
- Codebase total ~800 linhas
- Sem complexidade de state management
- Sem build step
- Sem actualiza√ß√µes de depend√™ncias
- Garantido funcionar em 10 anos
- Load inicial mais r√°pido

**Consequ√™ncias:**
- ‚úÖ Zero depend√™ncias para manter
- ‚úÖ C√≥digo audit√°vel e simples
- ‚úÖ Longevidade garantida
- ‚ö†Ô∏è Manipula√ß√£o DOM manual
- ‚ö†Ô∏è Sem reutiliza√ß√£o de componentes (aceit√°vel nesta escala)

---

## ADR-003: Sem Build Step

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
A maioria dos projectos modernos usa bundlers (Vite, webpack, esbuild).

**Decis√£o:**
Sem build step. Ficheiros servidos directamente.

**Raz√µes:**
- Editar e refrescar (DX simples)
- Sem configura√ß√£o de tooling
- Funciona abrindo o HTML directamente
- Deploy = copiar ficheiros

**Consequ√™ncias:**
- ‚úÖ Setup instant√¢neo
- ‚úÖ Sem bugs de build
- ‚ö†Ô∏è Sem minifica√ß√£o (aceit√°vel, <50KB total de JS)
- ‚ö†Ô∏è Sem tree-shaking (n√£o temos depend√™ncias)

---

## ADR-004: CSVs da ERSE como Fonte Prim√°ria

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
A ERSE (regulador) publica dados oficiais de todas as ofertas.

**Decis√£o:**
Usar os CSVs do simulador ERSE como fonte √∫nica de verdade.

**Ficheiros:**
- `Precos_ELEGN.csv` ‚Äî Pre√ßos por oferta/pot√™ncia/tarifa (~13K linhas)
- `CondComerciais.csv` ‚Äî Condi√ß√µes comerciais, contactos, links (~700 linhas)

**Raz√µes:**
- Fonte oficial e regulamentada
- Todos os comercializadores obrigados a reportar
- Actualiza√ß√£o mensal garantida
- Inclui telefones e links (descoberta v2!)

**Consequ√™ncias:**
- ‚úÖ Dados fi√°veis e completos
- ‚úÖ Inclui contactos dos comercializadores
- ‚ö†Ô∏è Alguns links podem estar desactualizados
- ‚ö†Ô∏è Formato pode mudar (raro)

---

## ADR-005: Actualiza√ß√£o Manual dos CSVs

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
Os CSVs da ERSE actualizam mensalmente. Op√ß√µes:
1. Scraping autom√°tico
2. Playwright (headless browser)
3. Download manual

**Decis√£o:**
Download manual + commit.

**Raz√µes:**
- Site da ERSE usa JavaScript (curl n√£o funciona)
- Playwright adiciona 50MB de depend√™ncia
- Scripts autom√°ticos quebram quando sites mudam
- Download manual demora 2 minutos/m√™s
- ROI da automa√ß√£o √© negativo

**Consequ√™ncias:**
- ‚úÖ Zero manuten√ß√£o de scripts
- ‚úÖ Controlo sobre o que √© commitado
- ‚ö†Ô∏è Precisa lembrar de actualizar
- ‚ö†Ô∏è Dados podem ter 1-30 dias de atraso

**Nota:** Temos um GitHub Action preparado (`update-erse.yml`) caso a ERSE disponibilize download directo no futuro.

---

## ADR-006: Insights ERSE a Cada 4 Meses

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Relat√≥rios da ERSE t√™m estat√≠sticas √∫teis para social proof:
- % de portugueses no mercado livre
- N√∫mero de mudan√ßas por m√™s
- Compara√ß√£o com Europa

Op√ß√µes de frequ√™ncia:
1. Mensal (sincronizado com CSVs)
2. Trimestral
3. A cada 4 meses
4. Manual quando relevante

**Decis√£o:**
Actualiza√ß√£o a cada 4 meses via GitHub Action.

**Raz√µes:**
- Dados n√£o mudam drasticamente m√™s a m√™s
- 87% ‚Üí 88% n√£o altera o copy
- Reduz manuten√ß√£o
- 3x por ano √© suficiente

**Consequ√™ncias:**
- ‚úÖ Dados sempre razoavelmente actuais
- ‚úÖ Baixa manuten√ß√£o
- ‚ö†Ô∏è Pode estar 1-4 meses desactualizado
- ‚ö†Ô∏è Script de parsing pode quebrar se formato mudar

**Uso:**
Integrar contextualmente no copy, sempre com cita√ß√£o:
```
"68 mil portugueses mudaram de fornecedor s√≥ no √∫ltimo m√™s."
Fonte: ERSE, Agosto 2025
```

---

## ADR-007: Input √önico ‚Ç¨/m√™s com Op√ß√£o PDF

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
v1 pedia pot√™ncia + consumo + tarifa (3 inputs obrigat√≥rios). Fric√ß√£o alta.

Op√ß√µes para v2:
1. Manter 3 inputs
2. Input √∫nico ‚Ç¨/m√™s (estimar o resto)
3. PDF obrigat√≥rio
4. Input ‚Ç¨/m√™s + PDF opcional

**Decis√£o:**
Input √∫nico ‚Ç¨/m√™s com √≠cone de PDF subtil como op√ß√£o.

**Layout:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ç¨ 95                            ‚îÇ  ‚îÇ üìÑ  ‚îÇ
‚îÇ ou arrasta a tua fatura em PDF  ‚îÇ  ‚îÇ     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Raz√µes:**
- Reduz fric√ß√£o de entrada para 1 campo
- ‚Ç¨/m√™s toda a gente sabe
- PDF d√° precis√£o para quem quer
- √çcone n√£o distrai mas est√° dispon√≠vel

**Comportamento:**
- Se ‚Ç¨ ‚Üí c√°lculo estimado (com disclaimer)
- Se PDF ‚Üí c√°lculo preciso
- Se ambos ‚Üí PDF tem preced√™ncia

**Consequ√™ncias:**
- ‚úÖ Entrada em 5 segundos
- ‚úÖ Op√ß√£o de precis√£o para power users
- ‚ö†Ô∏è Estimativa pode variar ¬±15% do real
- ‚ö†Ô∏è PDF parsing adiciona complexidade

---

## ADR-008: Estimativa vs Preciso (dois modos)

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Com input ‚Ç¨/m√™s, n√£o sabemos pot√™ncia nem consumo exacto.

**Decis√£o:**
Dois modos de opera√ß√£o:
1. **Estimativa** ‚Äî assume defaults, mostra disclaimer
2. **Preciso** ‚Äî PDF ou input manual, sem disclaimer

**Defaults para estimativa:**
- Pot√™ncia: 4.6 kVA (mais comum em PT)
- Tarifa: simples (conservador)
- Consumo: calculado a partir do ‚Ç¨

**Consequ√™ncias:**
- ‚úÖ Valor imediato mesmo com dados m√≠nimos
- ‚úÖ Caminho para precis√£o quando necess√°rio
- ‚ö†Ô∏è Disclaimer necess√°rio ("estimativa")
- ‚ö†Ô∏è Flow de refinamento adiciona complexidade

---

## ADR-009: F√≥rmula de C√°lculo

**Data:** Novembro 2024 (v1), refinada em v2

**Status:** ‚úÖ Aceite

**Contexto:**
Calcular factura mensal a partir dos dados CSV.

**F√≥rmula:**

```javascript
// Tarifa simples
custoMensal = (TF √ó 30) + (consumo √ó TV)

// Bi-hor√°ria (com distribui√ß√£o assumida)
custoMensal = (TF √ó 30) + (consumo √ó 0.35 √ó TVV) + (consumo √ó 0.65 √ó TVFV)

// Tri-hor√°ria (com distribui√ß√£o assumida)
custoMensal = (TF √ó 30) + (consumo √ó 0.30 √ó TVVz) + (consumo √ó 0.50 √ó TVC) + (consumo √ó 0.20 √ó TVP)

// Taxas e IVA
subtotal = custoMensal + IEC + audiovisual
total = subtotal √ó 1.23
```

**Constantes:**
- IVA: 23%
- Audiovisual: ‚Ç¨2.85/m√™s
- IEC: ‚Ç¨0.001/kWh
- Dias/m√™s: 30

**Consequ√™ncias:**
- ‚úÖ Alinhado com f√≥rmula ERSE
- ‚úÖ Validado contra facturas reais
- ‚ö†Ô∏è Varia√ß√£o ¬±2% vs factura real (simplifica√ß√£o IVA)

---

## ADR-010: Defaults Assumidos

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Quando o utilizador s√≥ d√° ‚Ç¨/m√™s, precisamos de assumir valores.

**Decis√£o:**

| Par√¢metro | Default | Raz√£o |
|-----------|---------|-------|
| Pot√™ncia | 4.6 kVA | Mais comum em Portugal |
| Tarifa | Simples (1) | Mais comum, conservador |
| Distribui√ß√£o bi-hor√°ria | 35% vazio / 65% fora | M√©dia t√≠pica |
| Distribui√ß√£o tri-hor√°ria | 30% vazio / 50% cheias / 20% ponta | M√©dia t√≠pica |

**Consequ√™ncias:**
- ‚úÖ Permite c√°lculo com input m√≠nimo
- ‚ö†Ô∏è Pode sobre/subestimar para perfis at√≠picos
- ‚ö†Ô∏è Disclaimer obrigat√≥rio

---

## ADR-011: Loss Framing

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Como apresentar o resultado? Op√ß√µes:
1. "Poupas ‚Ç¨288/ano" (gain framing)
2. "Perdes ‚Ç¨288/ano" (loss framing)
3. Ambos

**Decis√£o:**
Loss framing como mensagem principal.

```
üí∏ Est√°s a perder ‚Ç¨288/ano
```

**Raz√µes:**
- Loss aversion √© mais forte que gain (Kahneman)
- "Perder" cria urg√™ncia
- "Poupar" √© abstracto, "perder" √© concreto
- Mais honesto (j√° est√°s a pagar isto)

**Consequ√™ncias:**
- ‚úÖ Maior impacto emocional
- ‚úÖ Incentiva ac√ß√£o
- ‚ö†Ô∏è Pode parecer agressivo (mitigar com tom amig√°vel)

---

## ADR-012: Cart√£o de Oferta com Detalhes Expans√≠veis

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Quanta informa√ß√£o mostrar sobre cada oferta?

Op√ß√µes:
1. Tudo vis√≠vel (overwhelming)
2. M√≠nimo (falta contexto)
3. Progressivo (core vis√≠vel, detalhes expans√≠veis)

**Decis√£o:**
Cart√£o com info essencial vis√≠vel + `<details>` para expandir.

**Sempre vis√≠vel:**
- Nome do comercializador
- Nome da tarifa
- Pre√ßo mensal
- Poupan√ßa (m√™s + ano)
- CTAs (mudar, ver site)

**Expans√≠vel:**
- Termo fixo (‚Ç¨/dia) com tooltip
- Termo vari√°vel (‚Ç¨/kWh) com tooltip
- Fideliza√ß√£o
- Energia renov√°vel

**Raz√µes:**
- Foco no essencial (pre√ßo, poupan√ßa)
- Detalhes dispon√≠veis para quem quer
- `<details>` √© nativo e acess√≠vel
- Reduz cognitive load inicial

**Consequ√™ncias:**
- ‚úÖ Interface limpa
- ‚úÖ Informa√ß√£o completa dispon√≠vel
- ‚úÖ Acess√≠vel (nativo HTML)

---

## ADR-013: Tooltips para Termos T√©cnicos

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Termos como "termo fixo", "kWh", "kVA" n√£o s√£o familiares a todos.

Op√ß√µes:
1. Gloss√°rio separado
2. Tooltips inline (‚ìò)
3. Assumir que sabem

**Decis√£o:**
Tooltips inline com √≠cone ‚ìò ao lado de termos t√©cnicos.

**Termos com tooltip:**
- Termo fixo
- Termo vari√°vel
- kWh
- Pot√™ncia contratada
- Consumo mensal
- CPE
- Fideliza√ß√£o

**Comportamento:**
- Hover (desktop): aparece ap√≥s 200ms
- Focus (keyboard): aparece imediatamente
- Tap (mobile): toggle
- Escape: fecha

**Consequ√™ncias:**
- ‚úÖ Educa√ß√£o contextual
- ‚úÖ N√£o interrompe o flow
- ‚úÖ Acess√≠vel (keyboard + screen reader)
- ‚ö†Ô∏è Adiciona complexidade de implementa√ß√£o

---

## ADR-014: Top N Ofertas, N√£o Todas

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
A compara√ß√£o retorna 300-500 ofertas. Mostrar todas causa paralisia.

**Decis√£o:**
Mostrar melhor oferta destacada + "Ver mais X ofertas" para expandir top 10.

**Raz√µes:**
- Choice paralysis √© real
- Top 1 cobre 80% dos casos
- Top 10 cobre 99%
- Quem quer ver todas pode expandir

**Consequ√™ncias:**
- ‚úÖ Interface limpa
- ‚úÖ Decis√£o clara (a melhor est√° destacada)
- ‚ö†Ô∏è Pode esconder ofertas interessantes (ex: sem fideliza√ß√£o)

---

## ADR-015: Contactos Reais do CSV

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Descobrimos que o CSV `CondComerciais.csv` tem:
- `ContactoComercialTel` ‚Äî telefone do comercializador
- `LinkCOM` ‚Äî website do comercializador
- `LinkOfertaCom` ‚Äî link directo para a oferta

**Decis√£o:**
Usar estes dados no guia de mudan√ßa e no cart√£o de oferta.

**Uso:**
```
1. Liga 800 100 100
   Linha gratuita da Endesa
   
   [Ir para o site ‚Üí]
```

**Consequ√™ncias:**
- ‚úÖ Informa√ß√£o actionable real
- ‚úÖ Fonte oficial (ERSE)
- ‚ö†Ô∏è Alguns links podem estar desactualizados
- ‚ö†Ô∏è Alguns campos podem estar vazios (fallback necess√°rio)

---

## ADR-016: Calend√°rio: 2 Meses Default

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Queremos que os utilizadores voltem a verificar periodicamente.

Op√ß√µes de default:
1. 1 m√™s (muito frequente)
2. 2 meses
3. 3 meses (original)
4. 6 meses (muito espa√ßado)

**Decis√£o:**
Default de 2 meses, com op√ß√µes 1/2/6.

**Raz√µes:**
- Mais agressivo que 3 (maior engagement)
- Pre√ßos mudam frequentemente
- 2 meses √© tempo suficiente para n√£o ser spam
- Mant√©m o produto na mente do utilizador

**Consequ√™ncias:**
- ‚úÖ Maior probabilidade de re-engagement
- ‚ö†Ô∏è Pode parecer frequente demais para alguns

---

## ADR-017: PDF Parsing Client-Side

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
Utilizadores querem upload de facturas para auto-preenchimento.

Op√ß√µes:
1. Server-side (Python, Node)
2. Client-side com pdf.js
3. OCR service (Google Vision, AWS)

**Decis√£o:**
Client-side com Mozilla pdf.js via CDN.

**Raz√µes:**
- Privacidade: PDF nunca sai do browser
- Custo: zero
- Velocidade: 1-3 segundos
- Sem depend√™ncia de servidor

**Trade-offs:**
- ~200KB adicional de JS
- S√≥ extrai texto (n√£o funciona com PDFs scanned)
- Regex fr√°gil para cada fornecedor

**Fornecedores suportados (inicial):**
- EDP
- Endesa
- Galp
- Goldenergy

**Consequ√™ncias:**
- ‚úÖ Privacidade total
- ‚úÖ Funciona offline
- ‚ö†Ô∏è Patterns quebram se fornecedores mudarem formato
- ‚ö†Ô∏è PDFs de imagem n√£o funcionam

---

## ADR-018: URL State para Bookmarks

**Data:** Novembro 2025 (v2)

**Status:** ‚úÖ Aceite

**Contexto:**
Queremos que utilizadores possam guardar/partilhar resultados.

**Decis√£o:**
Encodar estado no URL como base64.

**Formato:**
```
guesswatts.com/?s=eyJwIjo0LjYsImMiOjM1MCwiYiI6NzF9
```

**Decoded:**
```json
{
  "p": 4.6,      // pot√™ncia
  "c": 350,      // consumo
  "t": 1,        // tarifa
  "b": 71,       // melhor pre√ßo
  "d": "2025-11"  // data
}
```

**Raz√µes:**
- URL bookmarkable
- Partilh√°vel
- Permite "voltar e comparar"
- Data permite detectar staleness

**Consequ√™ncias:**
- ‚úÖ Bookmarks funcionam
- ‚úÖ Partilha f√°cil
- ‚ö†Ô∏è URL fica mais longo
- ‚ö†Ô∏è Estado pode ficar desactualizado

---

## ADR-019: Portugu√™s de Portugal Apenas

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
P√∫blico-alvo s√£o consumidores portugueses.

**Decis√£o:**
Apenas PT-PT. Sem internacionaliza√ß√£o.

**Raz√µes:**
- 100% dos utilizadores falam portugu√™s
- Termos t√©cnicos n√£o traduzem bem
- Sem complexidade de i18n
- Alinhado com dados ERSE

**Consequ√™ncias:**
- ‚úÖ Codebase mais simples
- ‚úÖ Copy mais natural
- ‚ö†Ô∏è Exclui n√£o-falantes de portugu√™s

---

## ADR-020: Segmento Dom√©stico Apenas

**Data:** Novembro 2024 (v1), mantido em v2

**Status:** ‚úÖ Aceite

**Contexto:**
Dados ERSE incluem dom√©stico e empresarial.

**Decis√£o:**
Filtrar para dom√©stico apenas (`Segmento !== 'Ndom'`).

**Raz√µes:**
- Pre√ßos empresariais s√£o mais complexos
- Empresas t√™m necessidades diferentes
- Dom√©stico √© o mercado maior
- UX mais simples

**Consequ√™ncias:**
- ‚úÖ Interface simplificada
- ‚úÖ C√°lculos mais directos
- ‚ö†Ô∏è Empresas n√£o servidas
- ‚ö†Ô∏è Poderia adicionar no futuro

---

## ADR-021: Provider Logo Implementation - Hybrid Cascading Fallback

**Data:** Dezembro 2024

**Status:** ‚úÖ Aceite

**Contexto:**
Precis√°vamos de mostrar logos dos fornecedores de energia no cart√£o de resultado. Os CSVs da ERSE cont√™m URLs dos websites (`LinkCOM`, `LinkOfertaCom`) mas n√£o URLs directas para logos.

**Op√ß√µes consideradas:**
1. **Manual mapping**: Criar um objecto com c√≥digo de fornecedor ‚Üí URL de logo
   - ‚úÖ Controlo total
   - ‚ö†Ô∏è Manuten√ß√£o manual, n√£o escala
   - ‚ö†Ô∏è Requer hospedagem de imagens ou URLs externas

2. **Clearbit Logo API apenas**: `logo.clearbit.com/{domain}`
   - ‚úÖ Simples, sem API key
   - ‚ö†Ô∏è Cobertura limitada para fornecedores portugueses (~50%)
   - ‚ö†Ô∏è Falha silenciosa se logo n√£o existir

3. **Google Favicon Service apenas**: `google.com/s2/favicons`
   - ‚úÖ Funciona para quase todos os dom√≠nios (~95%)
   - ‚ö†Ô∏è Qualidade inferior (favicons s√£o pequenos)
   - ‚ö†Ô∏è Pode n√£o ser o logo oficial

4. **Hybrid cascading fallback**: Clearbit ‚Üí Favicon ‚Üí Icon gen√©rico
   - ‚úÖ Melhor qualidade quando dispon√≠vel (Clearbit)
   - ‚úÖ Cobertura m√°xima (favicon como fallback)
   - ‚úÖ Sempre funciona (icon gen√©rico como √∫ltimo recurso)
   - ‚úÖ Zero manuten√ß√£o (extrai dom√≠nio automaticamente)
   - ‚ö†Ô∏è Ligeiramente mais complexo (3 n√≠veis de fallback)

**Decis√£o:**
Implementar sistema h√≠brido com cascading fallback:
1. **Prim√°rio**: Clearbit Logo API (alta qualidade para marcas conhecidas)
2. **Fallback 1**: Google Favicon Service (cobre quase todos os dom√≠nios)
3. **Fallback 2**: Icon gen√©rico Phosphor Duotone (sempre dispon√≠vel)

**Implementa√ß√£o:**
- Extrair dom√≠nio de `websiteUrl` usando `URL` API com regex fallback
- Gerar HTML com `<img>` tag e icon fallback oculto
- Event listeners JavaScript para cascading de erros
- CSS suporta tanto imagens como icons

**Raz√µes:**
- Melhor experi√™ncia: logos reais quando dispon√≠veis
- Zero manuten√ß√£o: funciona automaticamente para novos fornecedores
- Performance: loading ass√≠ncrono, n√£o bloqueia renderiza√ß√£o
- Acessibilidade: alt text com c√≥digo de fornecedor
- Robustez: sempre mostra algo, mesmo se todos os servi√ßos falharem

**Consequ√™ncias:**
- ‚úÖ Logos reais para ~70% dos fornecedores (Clearbit)
- ‚úÖ Cobertura ~95% com favicons
- ‚úÖ Sempre funcional (icon gen√©rico)
- ‚úÖ Zero manuten√ß√£o manual
- ‚ö†Ô∏è Depend√™ncia de servi√ßos externos (Clearbit, Google)
- ‚ö†Ô∏è Ligeira lat√™ncia no loading de logos (n√£o bloqueante)

---

## Template para Novos ADRs

```markdown
## ADR-XXX: [T√≠tulo]

**Data:** [M√™s Ano]

**Status:** ‚¨ú Proposto | ‚úÖ Aceite | ‚ùå Rejeitado | üîÑ Substitu√≠do por ADR-YYY

**Contexto:**
[Qual o problema ou necessidade?]

**Op√ß√µes consideradas:**
1. [Op√ß√£o A]
2. [Op√ß√£o B]
3. [Op√ß√£o C]

**Decis√£o:**
[O que decidimos e porqu√™]

**Consequ√™ncias:**
- ‚úÖ [Benef√≠cio]
- ‚ö†Ô∏è [Trade-off ou risco]
```
