/**
 * Button Components - Design System Implementation
 * 
 * Pixel-perfect match to design.html button styles
 * Includes: Default buttons, Segmented buttons, Copy button with blur transition, Submit button
 */

@layer components {
  /* ═══════════════════════════════════════════════════════════
     SHARED BASE COMPONENT - Interactive Elements
     Base class for buttons, tabs, pills, labels, chips
     All share the same visual foundation
     ═══════════════════════════════════════════════════════════ */
  
  .interactive-base {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    padding: var(--space-3) var(--space-5) var(--space-3) var(--space-4);
    border: 0.5px solid white;
    border-radius: var(--radius-sm);
    background: transparent;
    box-shadow: var(--shadow-xs);
    cursor: pointer;
    font-family: var(--font-sans);
    font-weight: var(--font-medium);
    font-size: var(--text-base-size);
    line-height: var(--text-default-leading);
    color: var(--color-foreground-primary);
    transition: transform var(--duration-normal) var(--ease-bounce);
    -webkit-tap-highlight-color: transparent;
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .interactive-base:active {
    transform: scale(0.97);
  }
  
  .interactive-base span {
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
  }
  
  /* If interactive-base is an <a> tag */
  a.interactive-base,
  a.interactive-base:hover,
  a.interactive-base:visited,
  a.interactive-base:active {
    text-decoration: none;
  }
  
  /* ═══════════════════════════════════════════════════════════
     BUTTON SLOT (Container)
     ═══════════════════════════════════════════════════════════ */
  
  .btn-slot {
    border: 0.5px solid var(--color-border-default);
    border-radius: var(--radius-sm);
  }
  
  /* Child elements inside btn-slot should have calculated border-radius */
  .btn-slot > * {
    border-radius: calc(var(--radius-sm) - 0.5px); /* Parent radius - border */
  }
  
  /* ═══════════════════════════════════════════════════════════
     BASE BUTTON - Uses interactive-base styles
     ═══════════════════════════════════════════════════════════ */
  
  .btn {
    /* Apply all interactive-base styles directly */
    display: flex;
    align-items: center;
    gap: var(--space-1);
    padding: var(--radius-sm) var(--space-2); /* 6px top/bottom, 8px left/right */
    border: 0.5px solid white;
    border-radius: var(--radius-sm);
    background: transparent;
    box-shadow: var(--shadow-xs);
    cursor: pointer;
    font-family: var(--font-sans);
    font-weight: var(--font-medium);
    font-size: var(--text-base-size); /* 14px */
    line-height: var(--text-default-leading);
    color: var(--color-foreground-primary);
    transition: 
      transform var(--duration-normal) var(--ease-bounce),
      background var(--duration-fast) var(--ease-out);
    -webkit-tap-highlight-color: transparent;
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .btn:hover {
    background: rgba(255, 255, 255, 0.4); /* Slightly lighter background on hover - white at 40% opacity */
  }
  
  .btn:active {
    transform: scale(0.97);
  }
  
  .btn span {
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
  }
  
  /* If button is an <a> tag */
  a.btn,
  a.btn:hover,
  a.btn:visited,
  a.btn:active {
    text-decoration: none;
  }
  
  .btn-icon {
    width: var(--text-base-size);
    height: var(--text-base-size);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* Phosphor Duotone icons styling */
  .btn-icon i,
  .btn-icon .ph-duotone {
    font-size: var(--text-base-size); /* 14px icon size */
    width: var(--text-base-size);
    height: var(--text-base-size);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: inherit;
    font-style: normal; /* Override base.css italic styling for icon elements */
    --ph-icon-fill-duotone: rgba(53, 68, 61, 0.06); /* Inner fill, foreground at 6% opacity - matches token */
  }
  
  /* Legacy SVG support (if any remain) */
  .btn-icon svg {
    width: var(--text-base-size);
    height: var(--text-base-size);
  }
  
  /* ═══════════════════════════════════════════════════════════
     SEGMENTED BUTTON
     ═══════════════════════════════════════════════════════════ */
  
  /* Segmented button - the container */
  .segmented-btn {
    display: flex;
    align-items: center;
    border: 0.5px solid white;
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-xs);
    position: relative;
    background: rgba(255, 255, 255, 0.1);
    transition: background var(--duration-fast) var(--ease-out);
  }
  
  .segmented-btn:hover {
    background: rgba(255, 255, 255, 0.1); /* Slightly lighter background on hover - white at 40% opacity */
  }
  
  /* Child buttons inside segmented-btn inherit parent's border-radius calculation */
  .segmented-btn > * {
    border-radius: calc(var(--radius-sm) - 0.5px); /* Parent radius - border */
  }
  
  /* Copy button inside segmented - needs FULL padding */
  .segmented-btn .copy-btn {
    padding: var(--radius-sm) var(--space-2); /* 6px top/bottom, 8px left/right */
    border: none;
    box-shadow: none;
  }
  
  /* Icon button (suffix) inside segmented - no border, background, or shadow */
  .segmented-btn .btn-suffix {
    border: none;
    background: none;
    box-shadow: none;
  }
  
  /* Remove the generic override that breaks copy button */
  /* .segmented-btn .btn { padding: 0.375rem 0.5rem; } - DELETED */
  
  /* Divider */
  .segmented-divider {
    width: 0.5px;
    height: var(--text-default-leading);
    background: var(--color-border-default);
  }
  
  /* Icon button (suffix) - square, matches secondary button visual style */
  .btn-suffix {
    display: flex;
    align-items: center;
    justify-content: center;
    /* Calculate padding to make square button matching button height */
    /* Button height = var(--radius-sm) + var(--text-default-leading) + var(--radius-sm) = ~32px */
    /* For square: padding = (height - icon size) / 2 */
    padding: calc((var(--radius-sm) + var(--text-default-leading) + var(--radius-sm) - var(--text-base-size)) / 2);
    border: 0.5px solid white; /* Same border as secondary button */
    border-radius: var(--radius-sm);
    background: transparent; /* Same background as secondary button */
    box-shadow: var(--shadow-xs); /* Same shadow as secondary button */
    /* Remove gap since icon-only button doesn't need spacing */
    gap: 0;
  }
  
  /* ═══════════════════════════════════════════════════════════
     COPY BUTTON - Blur Transition (Emil Kowalski style)
     ═══════════════════════════════════════════════════════════ */
  
  .copy-btn {
    position: relative;
    overflow: hidden;
    min-width: 6.25rem; /* 100px - fixed width for consistency */
    user-select: none;
    -webkit-user-select: none;
  }
  
  .copy-btn-content {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    transition: 
      opacity var(--duration-normal) var(--ease-bounce),
      filter var(--duration-normal) var(--ease-bounce),
      transform var(--duration-normal) var(--ease-bounce);
  }
  
  .copy-btn-default,
  .copy-btn-copied {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }
  
  .copy-btn-default span,
  .copy-btn-copied span {
    user-select: none;
    -webkit-user-select: none;
  }
  
  .copy-btn-copied {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    filter: blur(4px); /* Fixed blur value - not responsive */
    color: var(--color-accent-green);
  }
  
  .copy-btn-copied .btn-icon svg path,
  .copy-btn-copied .btn-icon svg polyline {
    stroke: var(--color-accent-green);
  }
  
  /* Copied state */
  .copy-btn.copied .copy-btn-default {
    opacity: 0;
    filter: blur(4px); /* Fixed blur value - not responsive */
    transform: scale(0.95);
  }
  
  .copy-btn.copied .copy-btn-copied {
    opacity: 1;
    filter: blur(0);
    transform: translate(-50%, -50%) scale(1);
  }
  
  /* ═══════════════════════════════════════════════════════════
     DROPDOWN
     ═══════════════════════════════════════════════════════════ */
  
  .dropdown-wrapper {
    position: relative;
  }
  
  .dropdown-trigger {
    transition: transform var(--duration-normal) var(--ease-bounce);
  }
  
  .dropdown-trigger:active {
    transform: scale(0.94);
  }
  
  /* Chevron rotation */
  .dropdown-trigger .btn-icon {
    transition: transform var(--duration-slower) var(--ease-spring);
  }
  
  .dropdown-wrapper.open .dropdown-trigger .btn-icon {
    transform: rotate(180deg);
  }
  
  .dropdown-menu {
    position: absolute;
    top: calc(100% + var(--space-1)); /* 4px gap between dropdown and segmented button */
    right: 0;
    width: fit-content; /* Fit content width */
    background: rgba(255, 255, 255, 0.2); /* Match secondary button background */
    border: 0.5px solid var(--color-border-default); /* Outer grey border */
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-xs); /* Match secondary button shadow */
    padding: var(--space-1);
    opacity: 0;
    pointer-events: none;
    transform: scale(0.95);
    transform-origin: top right;
    transition: 
      opacity var(--duration-slow) var(--ease-out),
      transform var(--duration-slow) var(--ease-out);
    z-index: var(--z-dropdown);
  }
  
  /* Inner white border using pseudo-element */
  .dropdown-menu::before {
    content: '';
    position: absolute;
    inset: 0;
    border: 0.5px solid white;
    border-radius: var(--radius-sm);
    pointer-events: none;
  }
  
  .dropdown-wrapper.open .dropdown-menu {
    opacity: 1;
    pointer-events: auto;
    transform: scale(1);
  }
  
  /* Dropdown items have calculated border-radius based on parent padding */
  .dropdown-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    width: 100%; /* Fill parent width */
    padding: var(--radius-sm) var(--space-2); /* 6px top/bottom, 8px left/right - match button padding */
    border: none;
    background: transparent;
    border-radius: calc(var(--radius-sm) - var(--space-1)); /* Parent radius - padding */
    font-family: var(--font-sans);
    font-weight: var(--font-medium);
    font-size: var(--text-sm-size);
    color: var(--color-foreground-primary);
    cursor: pointer;
    text-align: left;
    white-space: nowrap; /* Prevent text from breaking into multiple lines */
    transition: background var(--duration-fast) var(--ease-out);
    user-select: none;
    -webkit-user-select: none;
  }
  
  .dropdown-item span {
    user-select: none;
    -webkit-user-select: none;
  }
  
  .dropdown-item:hover {
    background: oklch(from var(--color-foreground-primary) l c h / 0.04); /* Lighter hover background using foreground at 4% opacity */
  }
  
  /* Fallback for browsers that don't support oklch() */
  @supports not (color: oklch(0% 0 0)) {
    .dropdown-item:hover {
      background: rgba(53, 68, 61, 0.04); /* #35443D at 4% opacity */
    }
  }
  
  .dropdown-item:active {
    background: oklch(from var(--color-foreground-primary) l c h / 0.08); /* Slightly darker on active */
    transition: background var(--duration-instant);
  }
  
  /* Fallback for browsers that don't support oklch() */
  @supports not (color: oklch(0% 0 0)) {
    .dropdown-item:active {
      background: rgba(53, 68, 61, 0.08); /* #35443D at 8% opacity */
    }
  }
  
  .dropdown-item .item-icon {
    width: var(--space-4);
    height: var(--space-4);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  /* Phosphor Duotone icons styling */
  .dropdown-item .item-icon i,
  .dropdown-item .item-icon .ph-duotone {
    font-size: var(--text-base-size); /* 14px icon size */
    width: var(--text-base-size);
    height: var(--text-base-size);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: inherit;
    font-style: normal; /* Override base.css italic styling for icon elements */
    --ph-icon-fill-duotone: rgba(53, 68, 61, 0.06); /* Inner fill, foreground at 6% opacity - matches token */
  }
  
  /* Dropdown logo images (ChatGPT, Claude) - greyscale matching foreground color */
  .dropdown-item .item-icon .dropdown-logo {
    width: var(--text-base-size); /* 14px - same as icon size */
    height: var(--text-base-size);
    object-fit: contain;
    display: block;
    filter: grayscale(100%) brightness(0); /* Convert to greyscale black to match foreground */
    opacity: 0.9; /* Match icon opacity */
  }
  
  /* Legacy SVG support */
  .dropdown-item .item-icon svg {
    width: var(--space-4);
    height: var(--space-4);
  }
  
  /* ═══════════════════════════════════════════════════════════
     SUBMIT BUTTON
     ═══════════════════════════════════════════════════════════ */
  
  .submit-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
    padding: var(--radius-sm) var(--space-2); /* 6px top/bottom, 8px left/right */
    background-color: var(--color-foreground-primary);
    border: none;
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-button);
    cursor: pointer;
    font-family: var(--font-sans);
    font-weight: var(--font-medium);
    font-size: var(--text-base-size); /* 14px */
    line-height: var(--text-default-leading);
    color: var(--color-text-white);
    position: relative;
    overflow: hidden;
    transition: transform var(--duration-normal) var(--ease-bounce);
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .submit-btn:active {
    transform: scale(0.97);
  }
  
  .submit-btn::after {
    content: '';
    position: absolute;
    inset: 0;
    box-shadow: var(--shadow-button-inset, 0px 1px 0px 0px inset rgba(255, 255, 255, 0.25));
    pointer-events: none;
  }
}

