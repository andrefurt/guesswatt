<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <title>GuessWatt</title>
  <style>
    /* Minimal functional styles only - no visual decoration */
    
    /* Required for functionality */
    .mode-form {
      display: none;
    }
    
    .mode-form.active {
      display: block;
    }
    
    /* .tab.active - kept for JS logic, no styling needed */
    
    .dropdown-menu {
      display: none;
    }
    
    .dropdown-menu.is-open {
      display: block;
    }
    
    .tooltip {
      display: none;
    }
    
    .tooltip.is-visible {
      display: block;
    }
    
    #pdf-loaded {
      display: none;
    }
    
    #precise-form {
      display: none;
    }
    
    #result {
      display: none;
    }
    
    /* Functional cursor styles */
    button,
    .tooltip-trigger,
    #pdf-upload-box {
      cursor: pointer;
    }
    
    /* Hidden file input */
    #pdf-input {
      display: none;
    }
    
    /* Accessibility: visually hidden but available to screen readers */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
    
    /* Accessibility: ensure focusable elements are visible */
    button:focus-visible,
    input:focus-visible,
    select:focus-visible,
    a:focus-visible {
      outline: 2px solid currentColor;
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div id="app-root">
    <!-- Header -->
    <header>
      <a href="./" id="topbar-logo">GuessWatt</a>
      <nav>
        <a href="sobre.html">Sobre</a>
        <div class="dropdown">
          <button type="button" id="copy-page-button">
            Copy Page â–¾
          </button>
          <div class="dropdown-menu" id="copy-page-menu">
            <a href="#" id="copy-markdown">Copy as Markdown</a>
            <a href="llms.txt" target="_blank">View llms.txt</a>
            <a href="#" id="open-chatgpt">Open in ChatGPT</a>
            <a href="#" id="open-claude">Open in Claude</a>
          </div>
        </div>
      </nav>
    </header>

    <!-- Main content -->
    <main>
      <!-- Page title section -->
      <section aria-labelledby="page-title">
        <h1 id="page-title">Quanto pagas de electricidade por mÃªs?</h1>
      </section>

      <!-- Calculator section -->
      <section aria-label="calculator">
        <!-- 
          AppCard: Main container for calculator
          Uses slots to project existing content into the component structure
        -->
        <app-card aria-label="Simulador de energia">
          <!-- Header slot: Tab navigation -->
          <header slot="header">
            <app-tabs>
              <div class="tabs" role="tablist">
                <button type="button" class="tab active" data-mode="estimate" role="tab" aria-selected="true">Estimativa</button>
                <button type="button" class="tab" data-mode="precise" role="tab" aria-selected="false">Preciso</button>
              </div>
            </app-tabs>
          </header>

          <!-- Tab content -->
          <div>
            <!-- Tab: Estimativa -->
            <app-form-section>
              <form id="estimate-form" class="mode-form active" role="tabpanel">
                <div>
                  <label for="monthly-bill" class="visually-hidden">Valor mensal da factura</label>
                  <span>â‚¬</span>
                  <input type="number" id="monthly-bill" placeholder="80" min="20" max="500" required>
                  <span>/mÃªs</span>
                  <button type="submit">Calcular</button>
                </div>
              </form>
            </app-form-section>

            <!-- Tab: Preciso -->
            <div id="precise-mode" class="mode-form" role="tabpanel">
              <!-- PDF dropzone (initial state) -->
              <div id="pdf-upload-box">
                <input type="file" id="pdf-input" accept=".pdf">
                <div id="pdf-empty">
                  <span>ðŸ“„</span>
                  <p>Arrasta a tua fatura ou clica para selecionar</p>
                </div>
                <!-- PDF loaded state -->
                <div id="pdf-loaded">
                  <div>
                    <span>âœ“ Factura carregada</span>
                    <button type="button" id="pdf-remove" aria-label="Remover PDF">âœ•</button>
                  </div>
                  <div id="pdf-extracted-data">
                    <!-- Populated dynamically -->
                  </div>
                </div>
              </div>

              <!-- Manual data entry button -->
              <button type="button" id="toggle-manual">
                Introduzir dados manualmente
              </button>

              <!-- Manual form -->
              <app-form-section>
                <form id="precise-form">
                <div class="field">
                  <div class="field-label">
                    <label for="power">Potencia contratada</label>
                    <span class="tooltip-trigger" data-tooltip="potencia-contratada" aria-label="InformaÃ§Ã£o sobre potÃªncia contratada">â“˜</span>
                  </div>
                  <select id="power" required>
                    <option value="1.15">1.15 kVA</option>
                    <option value="2.3">2.3 kVA</option>
                    <option value="3.45">3.45 kVA</option>
                    <option value="4.6" selected>4.6 kVA</option>
                    <option value="5.75">5.75 kVA</option>
                    <option value="6.9">6.9 kVA</option>
                    <option value="10.35">10.35 kVA</option>
                    <option value="13.8">13.8 kVA</option>
                    <option value="17.25">17.25 kVA</option>
                    <option value="20.7">20.7 kVA</option>
                  </select>
                </div>

                <div class="field">
                  <div class="field-label">
                    <label for="consumption">Consumo geral</label>
                    <span class="tooltip-trigger" data-tooltip="consumo-mensal" aria-label="InformaÃ§Ã£o sobre consumo mensal">â“˜</span>
                  </div>
                  <input type="number" id="consumption" placeholder="250" min="0" max="5000" required>
                  <span>kWh</span>
                  <span class="tooltip-trigger" data-tooltip="kwh" aria-label="InformaÃ§Ã£o sobre kWh">â“˜</span>
                </div>

                <div class="field">
                  <div class="field-label">
                    <label for="tariff-type">Tipo de tarifa</label>
                    <span class="tooltip-trigger" data-tooltip="tarifa-simples" aria-label="InformaÃ§Ã£o sobre tipo de tarifa">â“˜</span>
                  </div>
                  <select id="tariff-type" required>
                    <option value="1" selected>Simples</option>
                    <option value="2">Bi-horÃ¡ria</option>
                    <option value="3">Tri-horÃ¡ria</option>
                  </select>
                </div>

                <div class="field">
                  <div class="field-label">
                    <label for="current-provider">Operador actual</label>
                  </div>
                  <select id="current-provider">
                    <option value="">-- Seleccionar --</option>
                    <!-- Populated from PROVIDERS dynamically -->
                  </select>
                </div>

                <button type="submit">Calcular</button>
              </form>
              </app-form-section>
            </div>
          </div>
        </app-card>

        <!-- Results section -->
        <app-result-section>
          <div id="result" role="status" aria-live="polite">
            <!-- Populated dynamically -->
          </div>
        </app-result-section>
      </section>
    </main>

    <!-- Footer -->
    <footer id="footer">
      <p>Guesswatt compara tarifas de eletricidade em Portugal. NÃ£o somos uma empresa de energia.</p>
      <p>NÃ£o vendemos nada. Dados: <a href="https://www.erse.pt" target="_blank" rel="noopener">ERSE</a> (atualizado mensalmente)</p>
      <p>â†» Ãšltima actualizaÃ§Ã£o foi em <span id="last-update-month"></span> de <span id="last-update-year"></span></p>
      <p><a href="llms.txt">llms.txt</a></p>
    </footer>
  </div>

  <script type="module" src="components.js"></script>
  <script type="module" src="js/main.js"></script>
  <script>
    // Load last update date
    async function loadLastUpdate() {
      try {
        const response = await fetch('data/last-update.json');
        const data = await response.json();
        document.getElementById('last-update-month').textContent = data.month;
        document.getElementById('last-update-year').textContent = data.year;
      } catch (error) {
        console.error('Error loading last update:', error);
      }
    }
    
    // Dropdown toggle
    const copyPageButton = document.getElementById('copy-page-button');
    const copyPageMenu = document.getElementById('copy-page-menu');
    
    if (copyPageButton && copyPageMenu) {
      copyPageButton.addEventListener('click', (e) => {
        e.stopPropagation();
        copyPageMenu.classList.toggle('is-open');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.dropdown')) {
          copyPageMenu.classList.remove('is-open');
        }
      });
    }
    
    // Copy Page functionality
    const copyMarkdown = document.getElementById('copy-markdown');
    const openChatGPT = document.getElementById('open-chatgpt');
    const openClaude = document.getElementById('open-claude');
    
    // Determine which markdown file to use based on current page
    const isAboutPage = window.location.pathname.includes('sobre');
    const markdownFile = isAboutPage ? 'sobre.md' : 'index.md';
    
    // Copy as Markdown - fetch and copy to clipboard
    if (copyMarkdown && copyPageMenu) {
      copyMarkdown.addEventListener('click', async (e) => {
        e.preventDefault();
        try {
          const response = await fetch(markdownFile);
          const text = await response.text();
          await navigator.clipboard.writeText(text);
          
          // Visual feedback
          const originalText = copyMarkdown.textContent;
          copyMarkdown.textContent = 'âœ“ Copied!';
          setTimeout(() => {
            copyMarkdown.textContent = originalText;
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
        }
        copyPageMenu.classList.remove('is-open');
      });
    }
    
    // Open in ChatGPT
    let basePath = window.location.pathname.replace(/\/[^/]*$/, '') || '';
    basePath = basePath.replace(/\/+$/, ''); // Remove trailing slashes
    const llmsUrl = window.location.origin + basePath + '/llms.txt';
    const prompt = encodeURIComponent(`Use this documentation to answer questions about GuessWatt: ${llmsUrl}`);
    
    if (openChatGPT && copyPageMenu) {
      openChatGPT.addEventListener('click', (e) => {
        e.preventDefault();
        window.open(`https://chatgpt.com/?q=${prompt}`, '_blank');
        copyPageMenu.classList.remove('is-open');
      });
    }
    
    // Open in Claude
    if (openClaude && copyPageMenu) {
      openClaude.addEventListener('click', (e) => {
        e.preventDefault();
        window.open(`https://claude.ai/new?q=${prompt}`, '_blank');
        copyPageMenu.classList.remove('is-open');
      });
    }
    
    // Load last update on page load
    loadLastUpdate();
  </script>
</body>
</html>
